# Copyright (c) the Dviglo project
# License: MIT

# –£–∫–∞–∑—ã–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é CMake
cmake_minimum_required(VERSION 3.16)

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–Ω–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
# –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞
if(NOT CMAKE_CONFIGURATION_TYPES AND NOT CMAKE_BUILD_TYPE)
    # —Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥–µ—Ç Release
    set(CMAKE_BUILD_TYPE Release)

    # –ù–µ–ª—å–∑—è –æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é CMAKE_BUILD_TYPE –ø—É—Å—Ç–æ–π,
    # —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –±—É–¥—É—Ç –∑–∞–¥–∞–Ω—ã —Ñ–ª–∞–≥–∏ GCC –∏ MinGW:
    # * –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞: CXX_FLAGS = -std=c++20
    # * Release: CXX_FLAGS = -O3 -DNDEBUG -std=c++20
    # * Debug: CXX_FLAGS = -g -std=c++20
    # * RelWithDebInfo: CXX_FLAGS = -O2 -g -DNDEBUG -std=c++20
    # * MinSizeRel: CXX_FLAGS = -Os -DNDEBUG -std=c++20
    # –§–ª–∞–≥–∏ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ñ–∞–π–ª–µ build/source/dviglo/CMakeFiles/dviglo.dir/flags.make
endif()

# –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–∞–ø–æ–∫ –≤ IDE
set_property(GLOBAL PROPERTY USE_FOLDERS ON)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π
add_subdirectory(third_party/stb)

# –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
project(sprite_manipulator)

# –í–µ—Ä—Å–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ C++
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# –£–∫–∞–∑—ã–≤–∞–µ–º –°—Ç—É–¥–∏–∏ –Ω–∞ —Ç–æ, —á—Ç–æ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8.
# –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å U'üçå'. –£ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–≤, –ø–æ—Ö–æ–∂–µ, –Ω–µ—Ç —Å —ç—Ç–∏–º –ø—Ä–æ–±–ª–µ–º.
# https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2295r6.pdf
if(MSVC)
    add_compile_options(/utf-8)
endif()

# –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–∞
set(target_name sprite_manipulator)

# –°–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
file(GLOB_RECURSE source_files src/*.cpp src/*.hpp)

# –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
add_executable(${target_name} ${source_files})

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É
target_link_libraries(${target_name} PRIVATE stb)

# –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å _d
set_property(TARGET ${target_name} PROPERTY DEBUG_POSTFIX _d)

# –ó–∞—Å—Ç–∞–≤–ª—è–µ–º Visual Studio –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR}/src FILES ${source_files})

# –í Visual Studio —Ç–∞—Ä–≥–µ—Ç –±—É–¥–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω —Å—Ç–∞—Ä—Ç–æ–≤—ã–º –≤–º–µ—Å—Ç–æ ALL_BUILD,
# —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –Ω–µ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ –∏–≥—Ä—ã
set_property(DIRECTORY ${CMAKE_SOURCE_DIR} PROPERTY VS_STARTUP_PROJECT ${target_name})
